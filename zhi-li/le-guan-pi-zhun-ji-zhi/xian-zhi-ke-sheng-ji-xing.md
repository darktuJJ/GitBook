---
description: 这是乐观批准机制的一种实现，用于限制智能合约的可升级性。
---

# 限制可升级性

### 所有用户，而不仅仅是治理者，都应该有发言权

通过一个额外的机制，协议的终端用户——GYD 稳定币持有者——可以在协议的可升级性问题上拥有治理权。这种机制以 GYD 的一种替代“包装”形式存在，即 boundedGYD（bGYD）。

根据 `WrappedERC20WithEMA` 的实现，用户可以随时在持有 GYD 和包装后的 bGYD 之间进行选择，并自由地在两者之间转换。选择持有 bGYD 意味着投票支持限制协议的可升级性。

当用户在 GYD 和 bGYD 之间转换时，bGYD 合约中的移动平均值会更新。当移动平均值超过一个阈值，同时 bGYD 的总供应量也超过另一个阈值时，核心 Gyroscope 合约的可升级性通过治理变得更加困难。这表现在操作分级的难度增加上。

其核心思想是让终端用户决定系统在何时应该更具可升级性，何时核心基础设施应该被认为更加稳定，这基于市场是否选择采用 GYD 或 bGYD。此采用的变化是有意设计为较难的（例如，集成系统需要转换为使用 bGYD），因为在早期阶段，DeFi 领域本身尚未完全稳定，任何稳定币都可能需要随着 DeFi 的变化而调整参数和结构。

### 跟踪移动平均线

我们按如下方式用不规则间隔的指数移动平均值（EMA）来跟踪bGYD对GYD份额的移动平均值。用 i 索引EMA更新的时间点，其中 i=0 标记合约部署。让 ti 为时间索引 i 的区块高度，让 xi:=bGYD supply/GYD supply 为 ti 区块结束时的值。让 yi 为时间索引 i 的EMA。我们可以将EMA定义为：



$$
y_0 = 0 \\
y_i = y_{i-1} + K_i \cdot (x_i - y_{i-1}) \quad \text{if} \quad i > 0 \\
where  K_i = 1 - e^{-\frac{(t_i - t_{i-1})}{\tau}}
$$

在这里，τ 是一个常数（即合约的一个参数），通常被解释为时间窗口的宽度。注意，如果 xi 时间序列的间隔是规律的，那么所有的 Ki 都将相等，但在我们的情况下，这并不成立。Ki 的定义是由信号处理中EMA的连续形式启发的，参见[此处](https://stackoverflow.com/questions/1023860/exponential-moving-average-sampled-at-varying-times/1027808#1027808)。

注意，我们只在_之前更新的区块_跟踪EMA，而不是当前区块。这是为了防止通过例如使用闪电贷来操纵EMA。因此，上述公式中的 xi 和 ti 值指的是最近观察到的不是来自当前区块的值；当前区块的值不用于更新当前区块的EMA，而只会在下一个区块中使用。

这种翻译方法保留了原文中的数学符号和技术术语，同时将周围的文本翻译成中文，使读者能够理解上下文，同时保持数学和技术表达的准确性。如果您需要对特定部分进行进一步解释或有任何问题，请随时告诉我。

`_updateEMA()` 中的变量与上述公式中的变量对应如下：

<table><thead><tr><th width="263">Math</th><th>Code</th></tr></thead><tbody><tr><td>yi-1</td><td><code>expMovingAverage.value</code></td></tr><tr><td>xxi</td><td><code>previousWrappedPctOfSupply.value</code></td></tr><tr><td>ti−1</td><td><code>expMovingAverage.blockNb</code></td></tr><tr><td>ti</td><td><code>previousWrappedPctOfSupply.blockNb</code></td></tr><tr><td>τ</td><td><code>windowWidth</code></td></tr></tbody></table>

### 乐观批准

通过这种方式限制可升级性是乐观批准理念的一个应用，这是一种新的治理原语，允许治理变更以时间锁定和否决过程为条件。该机制非常灵活，不仅可以用于简化治理流程，还可以更好地协调协议参与者之间的激励，不仅适用于 Gyroscope，也适用于更广泛的 DeFi 治理。

阅读我们介绍乐观批准的[研究文章](https://ournetwork.substack.com/p/our-network-deep-dive-2)。

乐观批准可以帮助不同类型的参与者协调激励：一方拥有治理权（治理者），另一方（守护者）则在时间锁定期间拥有可选择的否决权。通常情况下，守护者不需要参与日常治理，但否决权使他们能够阻止那些偏离协议愿景的恶意提案。

乐观批准框架概括了在时间延迟期间，谁拥有治理权以及谁拥有否决权。该机制的参数包括：(1) 初始时间锁定持续时间，(2) 守护者投票增加时间锁定的阈值，(3) 守护者否决提案的投票阈值。

在此次应用于 Gyroscope 的首次实践中，通过限制可升级性，乐观批准机制旨在赋予协议用户否决权，以阻止他们不认同的治理变更。在这种情况下，协议用户履行了守护者的角色，维护协议愿景（例如维持稳定性）。该机制为治理者的权力引入了制衡。如果治理者试图偏离协议的共同愿景，Gyro Dollar 持有者将能够在时间延迟期间行使可选择的否决权来阻止它。通常情况下，如果治理行动是合理的，Gyro Dollar 持有者不需要采取任何行动。但如果治理行动存在争议，Gyro Dollar 持有者可以行使否决权来阻止该行动。



{% hint style="info" %}
乐观批准最初被设计用于此应用，目的是绕过我们在《[Stablecoins 2.0](https://arxiv.org/abs/2006.12388)》论文中基于模型提出的关于安全去中心化治理的不可能性猜想（猜想1
{% endhint %}
